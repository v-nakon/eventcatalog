document.addEventListener("DOMContentLoaded",(function(){var e=[].slice.call(document.querySelectorAll("img.lazy")),t=[].slice.call(document.querySelectorAll(".lazy-background")),n=[].slice.call(document.querySelectorAll("[data-bg]"));if("IntersectionObserver"in window){let a=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),a.unobserve(t)}}))}));e.forEach((function(e){a.observe(e)}));let c=new IntersectionObserver((function(e,t){e.forEach((function(e){e.isIntersecting&&(e.target.classList.add("visible"),c.unobserve(e.target))}))}));t.forEach((function(e){c.observe(e)}));let o=new IntersectionObserver((function(e,t){e.forEach((function(e){if(e.isIntersecting){let t=e.target;t.style.backgroundImage="url("+t.dataset.bg+")",o.unobserve(t)}}))}));n.forEach((function(e){o.observe(e)}))}else e.forEach((function(e){e.src=e.dataset.src,e.srcset=e.dataset.srcset})),t.forEach((function(e){e.classList.add("visible")})),n.forEach((function(e){e.style.backgroundImage="url("+e.dataset.bg+")"}))}));var searchName=document.querySelector("#event_name"),searchLocation=document.querySelector("#city"),modalNotFound=document.querySelector(".container_modal_notfound"),closeModalNotfound=document.querySelector(".close_modal_notfound");getCities("city"),getCategories(),closeModalNotfound.addEventListener("click",(function(){modalNotFound.style.display="none",document.location.href="/"}));let btnSearch=document.querySelector(".btn_search");function viewEvent(e){console.log("ID",e),console.log(window.location.href);let t=window.location.href+"event-page.html?id="+e;window.open(t)}function createEventCard(e){let t='\n\t<div class="event_card_content">\n\t  <img src="https://eventafisha.com/storage/'+e.images+'" alt="" class="event_card_img">\n\t  <div class="event_card_title">'+sliceText(e.title)+'</div>\n\t  <div class="event_card_tag">'+e.category.title+'</div>\n\t  <div class="event_card_date">'+new Date(e.start_date).toLocaleDateString()+'</div>\n\t  <div class="event_card_location">'+e.address+'</div>\n\t  <input class="event_card_btn" type="submit" value="Посмотреть" onclick="viewEvent('+e.id+')">\n\t</div>',n=document.querySelector(".container_events"),a=document.createElement("li");a.className="event_card",a.innerHTML=t,n.append(a)}function getCities(e){axios.get("https://eventafisha.com/api/v1/cities").then((function(t){for(let n in t.data)addOptionSelect(t.data[n],e)})).catch((function(e){console.log(e)})).then((function(){}))}function getCategories(){axios.get("https://eventafisha.com/api/v1/categories").then((function(e){for(let t in e.data)addCatToSearch(e.data[t],".container_category")})).catch((function(e){console.log(e)})).then((function(){}))}function addCatToSearch(e,t){let n=document.querySelector(t),a=document.createElement("div");a.classList.add("item_category"),a.setAttribute("category_id",e.id),a.innerHTML=e.title,n.appendChild(a),addEventToElement(a,e.id)}function addEventToElement(e,t){e.addEventListener("click",(function(){delActiveColor(),console.log("CAT - ",t),e.classList.add("color_active_cat"),document.querySelector(".arrow_down").classList.add("color_active_cat"),categorySearch=t}))}function delActiveColor(){let e=document.querySelectorAll(".color_active_cat");console.log("arr",e),e.forEach((function(e){e.classList.remove("color_active_cat")}))}function addOptionSelect(e,t){let n=document.getElementById(t),a=document.createElement("option");a.value=e.id,a.innerHTML=e.title,n.add(a)}btnSearch.addEventListener("click",()=>searchEvent("event_name","city"));var fromDateSearch="",toDateSearch="",nameEventSearch="",cityEventSearch="",categorySearch="",elCatAll=document.querySelector("#search_cat_all"),elCatMain1=document.querySelector("#search_cat_main1"),elCatMain2=document.querySelector("#search_cat_main2");function splitSearchDate(e){if(e.indexOf(" - ")>-1){let t=e.split(" - ");fromDateSearch=t[0],toDateSearch=t[1]}else fromDateSearch=e}function searchEvent(e,t){nameEventSearch=document.getElementById(e).value,cityEventSearch=document.getElementById(t).value,paginationAjax("#pagination",nameEventSearch,cityEventSearch,fromDateSearch,toDateSearch,categorySearch)}function removeEventList(){for(var e=document.querySelector(".container_events");e.firstChild;)e.removeChild(e.firstChild)}function checkSearchParam(e,t,n,a,c){let o="https://eventafisha.com/api/v1/events?paginate=";return""!==e&&(o+="&title="+e),""!==t&&(o+="&city_id="+t),""!==n&&(o+="&date_start="+n),""!==a&&(o+="&date_end="+a),""!==c&&(o+="&category_id="+c),o}function paginationAjax(e,t,n,a,c,o){let i=checkSearchParam(t,n,a,c,o);$(e).pagination({dataSource:i,locator:"data",totalNumberLocator:function(e){return console.log("test",e.total),e.total},pageSize:24,showPageNumbers:!0,showPrevious:!0,showNext:!0,showFirstOnEllipsisShow:!0,showLastOnEllipsisShow:!0,className:"paginationjs-theme paginationjs-small",alias:{pageNumber:"page",pageSize:"limit"},ajax:{},callback:function(e,t){0===e.length?modalNotFound.style.display="block":(removeEventList(),$.each(e,(function(e,t){createEventCard(t)})),window.scrollTo(0,0))}})}function sliceText(e){let t=e.replace(/<\/?[^>]+>/g,"");return t=t.slice(0,60),t.length<e.length&&(t+="..."),t}elCatAll.addEventListener("click",(function(){delActiveColor(),elCatAll.classList.add("color_active_cat"),categorySearch=""})),elCatMain1.addEventListener("click",(function(){delActiveColor(),elCatMain1.classList.add("color_active_cat"),categorySearch=4})),elCatMain2.addEventListener("click",(function(){delActiveColor(),elCatMain2.classList.add("color_active_cat"),categorySearch=5})),$((function(){paginationAjax("#pagination","","","","","")}));let $btn=$(".datepicker_btn"),$input=$("#dp"),dp=$input.datepicker({showEvent:"none",range:!0,onSelect:function(e,t){splitSearchDate(e)},minDate:new Date}).data("datepicker");$btn.on("click",(function(){dp.show(),dp.clear(),$input.focus()}));var catWindow=document.querySelector(".dropdown_content"),containerCatWindow=document.querySelector(".container_category"),btnShowCat=document.querySelector(".dropbtn");btnShowCat.addEventListener("click",(function(){catWindow.classList.toggle("show")})),window.onclick=function(e){e.target.matches(".dropbtn")||e.target.matches(".container_category")||e.target.matches(".item_category")||catWindow.classList.contains("show")&&catWindow.classList.remove("show")};